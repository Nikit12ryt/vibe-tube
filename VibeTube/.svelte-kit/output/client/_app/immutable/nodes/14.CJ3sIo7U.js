import{c as ke,a as f,f as $}from"../chunks/b5zj641C.js";import{i as Qe}from"../chunks/CPnGWO-2.js";import{o as We}from"../chunks/Bvetg77p.js";import{f as je,p as Xe,l as se,j as Ye,t as b,k as ea,o as e,n as c,y as aa,q as a,m as n,$ as ta,r as s,u as t,v as p,Z as sa}from"../chunks/BM2AIrRx.js";import{s as u,e as $e}from"../chunks/D17zy_22.js";import{l as ra,s as ia,i as M,a as da,b as we}from"../chunks/BLbrYCs1.js";import{h as la}from"../chunks/DMkD6tIR.js";import{I as na,l as va,t as oa,r as ua,b as N,c as ye,s as ca}from"../chunks/C02I7yOd.js";import{p as pa}from"../chunks/Dt7nbsjP.js";import{g as Ve}from"../chunks/DaEquOvF.js";import{H as ma}from"../chunks/aIAfHqPP.js";import{s as fa}from"../chunks/Doq7kNre.js";function _a(z,T){const D=ra(T,["children","$$slots","$$events","$$legacy"]);const H=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];na(z,ia({name:"save"},()=>D,{get iconNode(){return H},children:(P,re)=>{var d=ke(),r=je(d);fa(r,T,"default",{}),f(P,d)},$$slots:{default:!0}}))}var ha=$('<div class="loading svelte-1xdndu8"> </div>'),xa=$("<div> </div>"),ga=$('<div class="thumbnail-preview"><img alt="Thumbnail preview"/> <span> </span></div>'),ba=$('<img class="svelte-1xdndu8"/>'),$a=$('<div class="no-thumb svelte-1xdndu8"> </div>'),wa=$('<form><!> <div class="form-row svelte-1xdndu8"><div class="form-column"><div class="form-group svelte-1xdndu8"><label for="title" class="svelte-1xdndu8"> </label> <input id="title" type="text" required maxlength="100" class="svelte-1xdndu8"/> <span class="char-count svelte-1xdndu8"> </span></div> <div class="form-group svelte-1xdndu8"><label for="description" class="svelte-1xdndu8"> </label> <textarea id="description" rows="10" maxlength="5000" class="svelte-1xdndu8"></textarea> <span class="char-count svelte-1xdndu8"> </span></div> <div class="form-group svelte-1xdndu8"><label for="thumbnail" class="svelte-1xdndu8"> </label> <input id="thumbnail" type="file" accept="image/*" class="svelte-1xdndu8"/> <!></div> <div class="form-actions svelte-1xdndu8"><a href="/studio/videos" class="btn-secondary svelte-1xdndu8"> </a> <button type="submit" class="btn-primary svelte-1xdndu8"><!> </button></div></div> <div class="preview-column svelte-1xdndu8"><h3 class="svelte-1xdndu8"> </h3> <div class="video-preview svelte-1xdndu8"><!> <div class="preview-info svelte-1xdndu8"><h4 class="svelte-1xdndu8"> </h4> <p class="svelte-1xdndu8"> </p> <span class="preview-stats svelte-1xdndu8"> </span></div></div></div></div></form>'),ya=$('<div class="studio svelte-1xdndu8"><!> <div class="studio-layout svelte-1xdndu8"><main class="studio-main full-width svelte-1xdndu8"><div class="edit-container svelte-1xdndu8"><h1 class="svelte-1xdndu8"> </h1> <!></div></main></div></div>');function za(z,T){Xe(T,!1);const D=()=>we(va,"$language",P),H=()=>we(pa,"$page",P),[P,re]=da(),d=c(),r=c(),F=c();let I=c(null),m=c(null),ie=c(!0),_=c(!1),w=c(""),h=c(""),x=c(""),k=c(null),y=c("");We(async()=>{const v=await fetch("/api/auth/me");if(!v.ok){window.location.href="/login";return}const i=await v.json();n(I,i.user),await Ce()});async function Ce(){const v=await fetch(`/api/videos/${e(F)}`);if(v.ok){const i=await v.json();if(n(m,i.video),e(m).user_id!==e(I).id){Ve("/studio/videos");return}n(h,e(m).title),n(x,e(m).description||""),n(y,e(m).thumbnail_url||e(m).thumbnail)}n(ie,!1)}function Me(v){const i=v.target;i.files&&i.files[0]&&(n(k,i.files[0]),n(y,URL.createObjectURL(e(k))))}async function Ne(v){v.preventDefault(),n(_,!0),n(w,"");const i=new FormData;i.append("title",e(h)),i.append("description",e(x)),e(k)&&i.append("thumbnail",e(k));const V=await fetch(`/api/videos/${e(F)}/update`,{method:"PUT",body:i});if(V.ok)n(w,e(d)==="ru"?"Видео успешно обновлено!":"Video updated successfully!"),setTimeout(()=>Ve("/studio/videos"),1500);else{const L=await V.json();n(w,L.error||(e(d)==="ru"?"Не удалось обновить видео":"Failed to update video"))}n(_,!1)}se(()=>D(),()=>{n(d,D())}),se(()=>e(d),()=>{n(r,oa[e(d)])}),se(()=>H(),()=>{n(F,H().params.id)}),Ye(),Qe();var R=ya();la("1xdndu8",v=>{aa(()=>{ta.title="Edit Video - Creator Studio"})});var de=a(R);ma(de,{get user(){return e(I)},onMenuClick:()=>{}});var le=s(de,2),ne=a(le),ve=a(ne),q=a(ve),Te=a(q,!0);t(q);var De=s(q,2);{var He=v=>{var i=ha(),V=a(i,!0);t(i),b(()=>u(V,(e(r),p(()=>e(r).loading)))),f(v,i)},Pe=v=>{var i=ke(),V=je(i);{var L=E=>{var S=wa(),oe=a(S);{var Se=l=>{var o=xa();let g;var U=a(o,!0);t(o),b(te=>{g=ca(o,1,"message svelte-1xdndu8",null,g,te),u(U,e(w))},[()=>({success:e(w).includes("success")})]),f(l,o)};M(oe,l=>{e(w)&&l(Se)})}var ue=s(oe,2),O=a(ue),Z=a(O),A=a(Z),Ue=a(A);t(A);var j=s(A,2);ua(j);var ce=s(j,2),ze=a(ce);t(ce),t(Z);var B=s(Z,2),G=a(B),Fe=a(G,!0);t(G);var C=s(G,2);sa(C);var pe=s(C,2),Ie=a(pe);t(pe),t(B);var J=s(B,2),K=a(J),Re=a(K,!0);t(K);var Q=s(K,2),qe=s(Q,2);{var Le=l=>{var o=ga(),g=a(o),U=s(g,2),te=a(U,!0);t(U),t(o),b(()=>{N(g,"src",e(y)),u(te,e(k)?e(d)==="ru"?"Новое превью (не сохранено)":"New thumbnail (not saved)":e(d)==="ru"?"Текущее превью":"Current thumbnail")}),f(l,o)};M(qe,l=>{e(y)&&l(Le)})}t(J);var me=s(J,2),W=a(me),Ee=a(W,!0);t(W);var X=s(W,2),fe=a(X);_a(fe,{size:18});var Oe=s(fe);t(X),t(me),t(O);var _e=s(O,2),Y=a(_e),Ze=a(Y,!0);t(Y);var he=s(Y,2),xe=a(he);{var Ae=l=>{var o=ba();b(()=>{N(o,"src",e(y)),N(o,"alt",e(h))}),f(l,o)},Be=l=>{var o=$a(),g=a(o,!0);t(o),b(()=>u(g,e(d)==="ru"?"Нет превью":"No thumbnail")),f(l,o)};M(xe,l=>{e(y)?l(Ae):l(Be,!1)})}var ge=s(xe,2),ee=a(ge),Ge=a(ee,!0);t(ee);var ae=s(ee,2),Je=a(ae,!0);t(ae);var be=s(ae,2),Ke=a(be);t(be),t(ge),t(he),t(_e),t(ue),t(S),b(()=>{u(Ue,`${e(r),p(()=>e(r).title)??""} *`),N(j,"placeholder",e(d)==="ru"?"Название видео":"Video title"),j.disabled=e(_),u(ze,`${e(h),p(()=>e(h).length)??""}/100`),u(Fe,(e(r),p(()=>e(r).description))),N(C,"placeholder",e(d)==="ru"?"Расскажите зрителям о вашем видео":"Tell viewers about your video"),C.disabled=e(_),u(Ie,`${e(x),p(()=>e(x).length)??""}/5000`),u(Re,(e(r),p(()=>e(r).thumbnail))),Q.disabled=e(_),u(Ee,(e(r),p(()=>e(r).cancel))),X.disabled=e(_),u(Oe,` ${e(_),e(d),e(r),p(()=>e(_)?e(d)==="ru"?"Сохранение...":"Saving...":e(r).saveChanges)??""}`),u(Ze,e(d)==="ru"?"Предпросмотр":"Preview"),u(Ge,e(h)||(e(d)==="ru"?"Видео без названия":"Untitled Video")),u(Je,e(x)||(e(d)==="ru"?"Нет описания":"No description")),u(Ke,`${e(m),p(()=>e(m).views)??""} ${e(r),p(()=>e(r).views)??""}`)}),ye(j,()=>e(h),l=>n(h,l)),ye(C,()=>e(x),l=>n(x,l)),$e("change",Q,Me),$e("submit",S,Ne),f(E,S)};M(V,E=>{e(m)&&E(L)},!0)}f(v,i)};M(De,v=>{e(ie)?v(He):v(Pe,!1)})}t(ve),t(ne),t(le),t(R),b(()=>u(Te,(e(r),p(()=>e(r).editVideo)))),f(z,R),ea(),re()}export{za as component};
