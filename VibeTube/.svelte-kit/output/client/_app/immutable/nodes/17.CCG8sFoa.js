import{c as Se,a as z,f as S}from"../chunks/b5zj641C.js";import{i as je}from"../chunks/CPnGWO-2.js";import{o as Fe}from"../chunks/Bvetg77p.js";import{f as Me,p as Oe,l as ne,j as Pe,t as k,o as e,k as Ce,n as u,y as He,m as l,q as s,r as o,$ as Ue,u as r,Z as qe,v as c}from"../chunks/BM2AIrRx.js";import{e as h,s as d}from"../chunks/D17zy_22.js";import{l as Ie,s as Ne,i as R,a as Ee,b as We}from"../chunks/BLbrYCs1.js";import{h as Ze}from"../chunks/DMkD6tIR.js";import{I as Ae,V as Be,c as ue,l as Ge,t as Je,r as Ke,s as de,b as ve}from"../chunks/C02I7yOd.js";import{H as Le}from"../chunks/aIAfHqPP.js";import{S as Qe}from"../chunks/BcVKEG13.js";import{s as Re}from"../chunks/Doq7kNre.js";function Xe(j,$){const x=Ie($,["children","$$slots","$$events","$$legacy"]);const F=[["path",{d:"M12 3v12"}],["path",{d:"m17 8-5-5-5 5"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}]];Ae(j,Ne({name:"upload"},()=>x,{get iconNode(){return F},children:(M,n)=>{var i=Se(),g=Me(i);Re(g,$,"default",{}),z(M,i)},$$slots:{default:!0}}))}var Ye=S('<div class="error svelte-tziouu"> </div>'),et=S('<p class="file-info svelte-tziouu"> </p>'),tt=S('<p class="file-info svelte-tziouu"> </p>'),at=S('<div class="app svelte-tziouu"><!> <!> <main><div class="upload-container svelte-tziouu"><div class="upload-card svelte-tziouu"><div class="header svelte-tziouu"><!> <h1 class="svelte-tziouu"> </h1></div> <form><!> <div role="button" tabindex="0"><!> <p class="svelte-tziouu"> </p> <span class="svelte-tziouu"> </span> <label class="file-label svelte-tziouu"><input type="file" accept="video/*" class="svelte-tziouu"/> </label> <!></div> <div class="form-group svelte-tziouu"><label for="title" class="svelte-tziouu"> </label> <input id="title" type="text" required class="svelte-tziouu"/></div> <div class="form-group svelte-tziouu"><label for="description" class="svelte-tziouu"> </label> <textarea id="description" rows="5" class="svelte-tziouu"></textarea></div> <div class="form-group svelte-tziouu"><label for="thumbnail" class="svelte-tziouu"> </label> <input id="thumbnail" type="file" accept="image/*" class="svelte-tziouu"/> <!></div> <button type="submit" class="btn-primary svelte-tziouu"> </button></form></div></div></main></div>');function ft(j,$){Oe($,!1);const x=()=>We(Ge,"$language",F),[F,M]=Ee(),n=u(),i=u();let g=u(null),y=u(!0),w=u(""),O=u(""),f=u(null),_=u(null),v=u(!1),b=u(""),D=u(!1);Fe(async()=>{const t=await fetch("/api/auth/me");if(!t.ok){window.location.href="/login";return}const a=await t.json();l(g,a.user)});function pe(t){const a=t.target;a.files&&a.files[0]&&l(f,a.files[0])}function ce(t){const a=t.target;a.files&&a.files[0]&&l(_,a.files[0])}function fe(t){if(t.preventDefault(),l(D,!1),t.dataTransfer?.files&&t.dataTransfer.files[0]){const a=t.dataTransfer.files[0];a.type.startsWith("video/")&&l(f,a)}}async function me(t){if(t.preventDefault(),l(b,""),!e(f)){l(b,e(n)==="ru"?"Пожалуйста, выберите видеофайл":"Please select a video file");return}if(!e(w).trim()){l(b,e(n)==="ru"?"Пожалуйста, введите название":"Please enter a title");return}l(v,!0);const a=new FormData;a.append("title",e(w)),a.append("description",e(O)),a.append("video",e(f)),e(_)&&a.append("thumbnail",e(_));const p=await fetch("/api/videos",{method:"POST",body:a});if(p.ok){const Q=await p.json();window.location.href=`/watch/${Q.video.id}`}else{const Q=await p.json();l(b,Q.error||(e(n)==="ru"?"Ошибка загрузки":"Upload failed")),l(v,!1)}}ne(()=>x(),()=>{l(n,x())}),ne(()=>e(n),()=>{l(i,Je[e(n)])}),Pe(),je();var P=at();Ze("tziouu",t=>{He(()=>{Ue.title="Upload Video - VibeTube"})});var X=s(P);Le(X,{get user(){return e(g)},onMenuClick:()=>l(y,!e(y))});var Y=o(X,2);Qe(Y,{get isOpen(){return e(y)},get user(){return e(g)}});var C=o(Y,2);let ee;var te=s(C),ae=s(te),H=s(ae),se=s(H);Be(se,{size:32});var re=o(se,2),_e=s(re,!0);r(re),r(H);var U=o(H,2),ie=s(U);{var be=t=>{var a=Ye(),p=s(a,!0);r(a),k(()=>d(p,e(b))),z(t,a)};R(ie,t=>{e(b)&&t(be)})}var m=o(ie,2);let le;var oe=s(m);Xe(oe,{size:48});var q=o(oe,2),he=s(q,!0);r(q);var I=o(q,2),ge=s(I,!0);r(I);var N=o(I,2),E=s(N),ze=o(E);r(N);var $e=o(N,2);{var xe=t=>{var a=et(),p=s(a);r(a),k(()=>d(p,`${e(n)==="ru"?"Выбрано":"Selected"}: ${e(f),c(()=>e(f).name)??""}`)),z(t,a)};R($e,t=>{e(f)&&t(xe)})}r(m);var W=o(m,2),Z=s(W),ye=s(Z);r(Z);var T=o(Z,2);Ke(T),r(W);var A=o(W,2),B=s(A),we=s(B,!0);r(B);var V=o(B,2);qe(V),r(A);var G=o(A,2),J=s(G),De=s(J);r(J);var K=o(J,2),Te=o(K,2);{var Ve=t=>{var a=tt(),p=s(a);r(a),k(()=>d(p,`${e(n)==="ru"?"Выбрано":"Selected"}: ${e(_),c(()=>e(_).name)??""}`)),z(t,a)};R(Te,t=>{e(_)&&t(Ve)})}r(G);var L=o(G,2),ke=s(L,!0);r(L),r(U),r(ae),r(te),r(C),r(P),k(()=>{ee=de(C,1,"svelte-tziouu",null,ee,{"sidebar-open":e(y)}),d(_e,(e(i),c(()=>e(i).uploadVideo))),le=de(m,1,"drop-zone svelte-tziouu",null,le,{"drag-over":e(D)}),d(he,(e(i),c(()=>e(i).dragDrop))),d(ge,e(n)==="ru"?"или":"or"),E.disabled=e(v),d(ze,` ${e(i),c(()=>e(i).selectFile)??""}`),d(ye,`${e(i),c(()=>e(i).title)??""} *`),ve(T,"placeholder",e(n)==="ru"?"Введите название видео":"Enter video title"),T.disabled=e(v),d(we,(e(i),c(()=>e(i).description))),ve(V,"placeholder",e(n)==="ru"?"Расскажите зрителям о вашем видео":"Tell viewers about your video"),V.disabled=e(v),d(De,`${e(i),c(()=>e(i).thumbnail)??""} (${e(n)==="ru"?"необязательно":"optional"})`),K.disabled=e(v),L.disabled=e(v),d(ke,(e(v),e(i),c(()=>e(v)?e(i).uploading:e(i).uploadVideo)))}),h("change",E,pe),h("drop",m,fe),h("dragover",m,t=>{t.preventDefault(),l(D,!0)}),h("dragleave",m,()=>l(D,!1)),ue(T,()=>e(w),t=>l(w,t)),ue(V,()=>e(O),t=>l(O,t)),h("change",K,ce),h("submit",U,me),z(j,P),Ce(),M()}export{ft as component};
